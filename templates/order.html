<html>

<link rel="stylesheet" type="text/css" href="/static/style.css">
<head>
<style>
#map {
        width: 500px;
        height: 400px;
      }
</style>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
// we use this function so that we can abstract any support for older 
// browsers into the details.
function createXmlHttp() {
	var xmlhttp;
	if (window.XMLHttpRequest) {
		xmlhttp = new XMLHttpRequest();
	} else {
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	if (!(xmlhttp)) {
		alert("Your browser does not support AJAX!");
	}
	return xmlhttp;
}

// use the given xmlHttp object to send the given parameters to the 
// target URL.  parameters should be a URL formatted string.
function postParameters(xmlHttp, target, parameters) {
	if (xmlHttp) {
		xmlHttp.open("POST",target,true);
		xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xmlHttp.send(parameters);
	}
}

function handleKeyUp() {
	var address = document.getElementById("addressTxt").value;
	var result = document.getElementById("addressResult");
	if (!address) {
		result.innerHTML = "";
		return;
	}
	var xmlHttp = createXmlHttp();
	xmlHttp.onreadystatechange=function() {
		if (xmlHttp.readyState == 4) {
			//result.innerHTML = "To " + address + "<br>";
			
			var mapObject = JSON.parse(xmlHttp.responseText);
			//window.alert("response " + mapObject.toString());
			if (mapObject) {
				result.innerHTML = mapObject.destination_addresses[0] + "<br>"
				if (mapObject.rows[0].elements[0].status == "OK") {
					result.innerHTML += mapObject.rows[0].elements[0].distance.text + ", ";
					result.innerHTML += mapObject.rows[0].elements[0].duration.text;
				} else {
					result.innerHTML = "No results found";
				}
			} else {
				result.innerHTML = "Not found";
			}
		} else {
			// response not ready
			result.innerHTML = "Searching...";
		}
	}
	postParameters(xmlHttp, "/getdistance?address=" + address.replace(/\s+/g, ''), "");
}

function initialize() {
	var mapCanvas = document.getElementById('map');
	var mapOptions = {
	  center: new google.maps.LatLng(40.4442, -79.9531),
	  zoom: 8,
	  mapTypeId: google.maps.MapTypeId.ROADMAP
	}
	var map = new google.maps.Map(mapCanvas, mapOptions);
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body>

<a class="header" href="home">
	<h1>university of pittsburgh <br> beer delivery<img src="/static/cathedal.png" alt="Picture of Cathedral" style="width:90px;height:90px;"></h1>
</a>	

<input type="text" id="addressTxt" onkeyup="handleKeyUp();">
<br><h2><div id="addressResult"></h2></div>
<div id="map"></div>
</body>
</html>