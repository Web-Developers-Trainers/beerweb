<html>

<link rel="stylesheet" type="text/css" href="/static/style.css">
<head>
<style>
	#map {
        width: 100%;
        height: 400px;
    }
	input, select {
		border: 2px solid #cdb87d !important;
		border-radius: 5px !important;
	}
	input:invalid {
		border:1px solid red;
	}
	input {
		color: #192857;
		font-size: 2em;
		height: 50px;
		outline: none;
		-webkit-appearance: none;
		width: 600px;
	}
	input:focus, select:focus {
		border: 2px solid #cdb87d;
	    border-collapse: separate;
	    box-shadow: 0 0 7px #cdb87d;
	}
	h2 {
		font-size: 30px;
	}
</style>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
// we use this function so that we can abstract any support for older 
// browsers into the details.
function createXmlHttp() {
	var xmlhttp;
	if (window.XMLHttpRequest) {
		xmlhttp = new XMLHttpRequest();
	} else {
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	if (!(xmlhttp)) {
		alert("Your browser does not support AJAX!");
	}
	return xmlhttp;
}

// use the given xmlHttp object to send the given parameters to the 
// target URL.  parameters should be a URL formatted string.
function postParameters(xmlHttp, target, parameters) {
	if (xmlHttp) {
		xmlHttp.open("POST",target,true);
		xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xmlHttp.send(parameters);
	}
}

function handleKeyUp() {
	var address = document.getElementById("addressTxt").value;
	var result = document.getElementById("addressResult");
	if (!address) {
		result.innerHTML = "";
		return;
	}
	var xmlHttp = createXmlHttp();
	xmlHttp.onreadystatechange=function() {
		if (xmlHttp.readyState == 4) {
			//result.innerHTML = "To " + address + "<br>";
			
			var mapObject = JSON.parse(xmlHttp.responseText);
			//window.alert("response " + mapObject.toString());
			if (mapObject) {
				result.innerHTML = mapObject.destination_addresses[0] + "<br>"
				if (mapObject.rows[0].elements[0].status == "OK") {
					var distance = price = Number(mapObject.rows[0].elements[0].distance.text.replace(/[^0-9\.]+/g,""));
					result.innerHTML += mapObject.rows[0].elements[0].distance.text + ", ";
					result.innerHTML += mapObject.rows[0].elements[0].duration.text + "<br>";

					if (distance && distance < 5) {
						result.innerHTML += '<span style="color:green;">Hey great news... WE DELIVER BEER TO YOU!!!</span>';
					} else {
						result.innerHTML += '<span style="color:red;">Sorry to say this, but you are outside of our delivery range :(</span>';
					}
				} else {
					result.innerHTML = "No results found";
				}
			} else {
				result.innerHTML = "Not found";
			}
		} else {
			// response not ready
			result.innerHTML = "Searching...";
		}
	}
	postParameters(xmlHttp, "/getdistance?address=" + address.replace(/\s+/g, ''), "");
}

function initialize() {
	var mapCanvas = document.getElementById('map');
	var mapOptions = {
	  center: new google.maps.LatLng(40.4442, -79.9531),
	  zoom: 14,
	  mapTypeId: google.maps.MapTypeId.ROADMAP
	}
	var map = new google.maps.Map(mapCanvas, mapOptions);
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body>
	<a class="header" href="home">
		<h1>university of pittsburgh <br> beer delivery<img src="/static/cathedal.png" alt="Picture of Cathedral" style="width:90px;height:90px;"></h1>
	</a>	

	<div style="margin:0 auto; text-align:center;">
		<input type="text" id="addressTxt" placeholder="Please enter your address..." onkeyup="handleKeyUp();">
	</div>

	<br>
	
	<h2 id="addressResult">Your address must be within a 5 mile radius of the university</h2>

	<div id="map"></div>
</body>
</html>
